{% extends 'base/base.html' %}
{% block title %}Excluir Prestador - EsferaFlow{% endblock %}
{% block page_title %}Excluir Prestador{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Card de Confirmação -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <!-- Header com Ícone de Alerta -->
        <div class="bg-red-500 px-6 py-4">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-3xl text-red-500"></i>
                </div>
                <div class="ml-4">
                    <h2 class="text-xl font-bold text-white">Confirmar Exclusão</h2>
                    <p class="text-red-100 text-sm">Esta ação não pode ser desfeita</p>
                </div>
            </div>
        </div>

        <!-- Informações do Prestador -->
        <div class="p-6 border-b">
            <p class="text-gray-700 mb-4">
                Você está prestes a excluir o seguinte prestador:
            </p>

            <div class="bg-gray-50 rounded-lg p-6 space-y-4">
                <div class="flex items-center">
                    <div class="w-16 h-16 rounded-full bg-primary flex items-center justify-center text-white text-2xl font-bold">
                        {{ provider.full_name|slice:":1"|upper }}
                    </div>
                    <div class="ml-4">
                        <h3 class="text-xl font-bold text-gray-800">{{ provider.full_name }}</h3>
                        <p class="text-gray-600">{{ provider.email }}</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t">
                    <div>
                        <p class="text-sm text-gray-600">CPF</p>
                        <p class="font-semibold text-gray-800">{{ provider.cpf }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Telefone</p>
                        <p class="font-semibold text-gray-800">{{ provider.phone }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Cidade</p>
                        <p class="font-semibold text-gray-800">{{ provider.city }}/{{ provider.state }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Cadastrado em</p>
                        <p class="font-semibold text-gray-800">{{ provider.created_at|date:"d/m/Y" }}</p>
                    </div>
                </div>

                {% if provider.service_types.exists %}
                <div class="pt-4 border-t">
                    <p class="text-sm text-gray-600 mb-2">Tipos de Serviço:</p>
                    <div class="flex flex-wrap gap-2">
                        {% for service_type in provider.service_types.all %}
                        <span class="px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-700">
                            {{ service_type.name }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Avisos -->
        <div class="p-6 bg-yellow-50 border-b border-yellow-100">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-info-circle text-yellow-600 text-xl"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-yellow-800">Atenção</h3>
                    <div class="mt-2 text-sm text-yellow-700">
                        <ul class="list-disc pl-5 space-y-1">
                            <li>Todos os dados do prestador serão removidos permanentemente</li>
                            <li>As ordens de serviço associadas a este prestador poderão ser afetadas</li>
                            <li>O histórico de atendimentos será mantido, mas sem vínculo direto ao prestador</li>
                            <li>Os dados bancários serão excluídos permanentemente</li>
                            <li>Esta ação não pode ser desfeita</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verificação de Ordens Ativas -->
        {% if provider.work_orders.exists %}
        <div class="p-6 bg-red-50 border-b border-red-100">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-circle text-red-600 text-xl"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">Prestador possui ordens de serviço</h3>
                    <div class="mt-2 text-sm text-red-700">
                        <p class="mb-2">Este prestador possui <strong>{{ provider.work_orders.count }}</strong> ordem(ns) de serviço cadastrada(s).</p>
                        <p>Certifique-se de que deseja realmente excluir este prestador, pois isso pode afetar os registros de ordens de serviço.</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Formulário de Confirmação -->
        <div class="p-6">
            <form method="post">
                {% csrf_token %}

                <div class="mb-6">
                    <label class="flex items-center">
                        <input
                            type="checkbox"
                            id="confirm-delete"
                            required
                            class="w-5 h-5 text-red-600 border-gray-300 rounded focus:ring-red-500"
                        >
                        <span class="ml-3 text-gray-700">
                            Confirmo que entendo que esta ação é <strong>permanente e irreversível</strong>
                        </span>
                    </label>
                </div>

                <!-- Botões -->
                <div class="flex items-center justify-end gap-4">
                    <a
                        href="{% url 'provider:list' %}"
                        class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                    >
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </a>
                    <button
                        type="submit"
                        class="px-6 py-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        id="delete-button"
                        disabled
                    >
                        <i class="fas fa-trash-alt mr-2"></i>Excluir Prestador
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Card Informativo -->
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fas fa-lightbulb text-blue-600 text-xl"></i>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-blue-800">Alternativa</h3>
                <div class="mt-1 text-sm text-blue-700">
                    <p>Se você deseja apenas desativar o prestador temporariamente, considere editar o cadastro ao invés de excluí-lo.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Habilitar botão de exclusão apenas quando checkbox for marcado
    document.getElementById('confirm-delete').addEventListener('change', function() {
        document.getElementById('delete-button').disabled = !this.checked;
    });
</script>

{% endblock %}

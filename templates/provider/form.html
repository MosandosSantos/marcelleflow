{% extends 'base/base.html' %}
{% block title %}{{ title }} - EsferaFlow{% endblock %}
{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- Cabeçalho -->
    <div class="mb-8 flex justify-between items-center">
        <div>
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                {{ title }}
            </h2>
            <p class="text-gray-500 mt-2">
                <i class="fas fa-info-circle mr-1"></i>
                {% if is_create %}
                Preencha os dados para cadastrar um novo prestador no sistema
                {% else %}
                Atualize os dados do prestador conforme necessário
                {% endif %}
            </p>
        </div>
        <a href="{% url 'provider:list' %}" class="group px-6 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 hover:border-gray-400 transition-all duration-300 shadow-md hover:shadow-lg">
            <i class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform duration-300"></i>Voltar
        </a>
    </div>

    <!-- Etapas -->
    <div class="mb-8 bg-white rounded-2xl shadow-lg p-6">
        <div class="flex flex-col md:flex-row items-center justify-center gap-6">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-bold shadow-lg">
                    <i class="fas fa-user"></i>
                </div>
                <span class="ml-3 font-semibold text-gray-800">Dados Pessoais</span>
            </div>
            <div class="hidden md:block w-24 h-1 bg-gradient-to-r from-blue-500 to-green-500 rounded-full"></div>
            <div class="flex items-center">
                <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-white font-bold shadow-lg">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <span class="ml-3 font-semibold text-gray-800">Endereço</span>
            </div>
            <div class="hidden md:block w-24 h-1 bg-gradient-to-r from-green-500 to-amber-500 rounded-full"></div>
            <div class="flex items-center">
                <div class="w-12 h-12 bg-gradient-to-r from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-bold shadow-lg">
                    <i class="fas fa-briefcase"></i>
                </div>
                <span class="ml-3 font-semibold text-gray-800">Serviços e Pagamento</span>
            </div>
        </div>
    </div>

    <!-- Formulário Principal -->
    <form method="post" class="space-y-6">
        {% csrf_token %}

        {% if form.errors %}
        <div class="bg-gradient-to-r from-red-50 to-red-100 border-l-4 border-red-500 rounded-xl p-5 shadow-md">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-bold text-red-800">Ops! Verifique os campos abaixo</h3>
                    <ul class="mt-2 text-sm text-red-700 space-y-1">
                        {% for field in form %}
                            {% for error in field.errors %}
                            <li><i class="fas fa-times mr-1"></i>{{ field.label }}: {{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}
                        <li><i class="fas fa-times mr-1"></i>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Card: Dados Pessoais -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform hover:scale-[1.01] transition-transform duration-300">
            <div class="bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 px-6 py-4">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="bg-white/20 rounded-lg p-2 mr-3">
                        <i class="fas fa-user text-xl"></i>
                    </span>
                    Dados Pessoais
                </h3>
                <p class="text-blue-100 text-sm mt-1 ml-12">Informações básicas do prestador</p>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2 group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-id-card text-blue-500 mr-2"></i>Nome Completo <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                <i class="fas fa-user text-lg"></i>
                            </span>
                            <input type="text" name="full_name" id="id_full_name" value="{{ form.full_name.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300 text-gray-800 font-medium"
                                placeholder="Digite o nome completo do prestador">
                        </div>
                        {% if form.full_name.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.full_name.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-envelope text-blue-500 mr-2"></i>E-mail <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                <i class="fas fa-at text-lg"></i>
                            </span>
                            <input type="email" name="email" id="id_email" value="{{ form.email.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300 text-gray-800"
                                placeholder="email@exemplo.com">
                        </div>
                        <p class="mt-1 text-xs text-gray-500"><i class="fas fa-info-circle mr-1"></i>Usado para comunicação e acesso</p>
                        {% if form.email.errors %}
                        <p class="mt-1 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-id-badge text-blue-500 mr-2"></i>CPF <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                <i class="fas fa-fingerprint text-lg"></i>
                            </span>
                            <input type="text" name="cpf" id="id_cpf" value="{{ form.cpf.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300 text-gray-800"
                                placeholder="000.000.000-00" maxlength="14">
                        </div>
                        {% if form.cpf.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.cpf.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-phone text-green-500 mr-2"></i>Telefone <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                <i class="fas fa-mobile-alt text-lg"></i>
                            </span>
                            <input type="text" name="phone" id="id_phone" value="{{ form.phone.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800"
                                placeholder="(00) 00000-0000" maxlength="15">
                        </div>
                        {% if form.phone.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.phone.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-birthday-cake text-pink-500 mr-2"></i>Data de Nascimento
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-pink-500 transition-colors">
                                <i class="fas fa-calendar-alt text-lg"></i>
                            </span>
                            <input type="date" name="birth_date" id="id_birth_date" value="{% if form.birth_date.value %}{{ form.birth_date.value|date:'Y-m-d' }}{% endif %}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-pink-500 focus:ring-4 focus:ring-pink-100 transition-all duration-300 text-gray-800">
                        </div>
                        {% if form.birth_date.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.birth_date.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Card: Endereço -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform hover:scale-[1.01] transition-transform duration-300">
            <div class="bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 px-6 py-4">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="bg-white/20 rounded-lg p-2 mr-3">
                        <i class="fas fa-map-marker-alt text-xl"></i>
                    </span>
                    Endereço
                </h3>
                <p class="text-green-100 text-sm mt-1 ml-12">Digite o CEP para preencher automaticamente</p>
            </div>

            <div class="p-6">
                <div class="mb-6 bg-gradient-to-r from-green-50 via-emerald-50 to-teal-50 p-6 rounded-2xl border-2 border-green-200 shadow-inner">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                        <div class="md:col-span-5 group">
                            <label class="block text-sm font-bold text-gray-700 mb-2">
                                <i class="fas fa-search-location text-green-600 mr-2"></i>CEP <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                    <i class="fas fa-map-pin text-lg"></i>
                                </span>
                                <input type="text" name="zip_code" id="id_zip_code" value="{{ form.zip_code.value|default:'' }}"
                                    class="w-full pl-12 pr-4 py-4 border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800 bg-white font-mono text-lg"
                                    placeholder="00000-000" maxlength="9">
                            </div>
                        </div>
                        <div class="md:col-span-4">
                            <button type="button" id="buscarCEP" class="w-full px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-bold hover:from-green-600 hover:to-emerald-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center">
                                <i class="fas fa-search mr-2"></i>Buscar CEP
                            </button>
                        </div>
                        <div class="md:col-span-3">
                            <div id="cepStatus" class="hidden"></div>
                        </div>
                    </div>
                    {% if form.zip_code.errors %}
                    <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.zip_code.errors.0 }}</p>
                    {% endif %}
                </div>

                <div class="grid grid-cols-1 md:grid-cols-6 gap-6">
                    <div class="md:col-span-4 group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-road text-green-500 mr-2"></i>Rua <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                <i class="fas fa-road text-lg"></i>
                            </span>
                            <input type="text" name="street" id="id_street" value="{{ form.street.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800"
                                placeholder="Nome da rua">
                        </div>
                        {% if form.street.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.street.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="md:col-span-2 group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-hashtag text-green-500 mr-2"></i>Número <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                <i class="fas fa-sort-numeric-up text-lg"></i>
                            </span>
                            <input type="text" name="number" id="id_number" value="{{ form.number.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800"
                                placeholder="Número">
                        </div>
                        {% if form.number.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.number.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="md:col-span-3 group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-building text-gray-400 mr-2"></i>Complemento
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                <i class="fas fa-door-open text-lg"></i>
                            </span>
                            <input type="text" name="complement" id="id_complement" value="{{ form.complement.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800"
                                placeholder="Apto, bloco, etc.">
                        </div>
                    </div>

                    <div class="md:col-span-3 group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-map text-green-500 mr-2"></i>Bairro <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                <i class="fas fa-map-signs text-lg"></i>
                            </span>
                            <input type="text" name="neighborhood" id="id_neighborhood" value="{{ form.neighborhood.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800"
                                placeholder="Bairro">
                        </div>
                        {% if form.neighborhood.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.neighborhood.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="md:col-span-4 group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-city text-green-500 mr-2"></i>Cidade <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                <i class="fas fa-city text-lg"></i>
                            </span>
                            <input type="text" name="city" id="id_city" value="{{ form.city.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800"
                                placeholder="Cidade">
                        </div>
                        {% if form.city.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.city.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="md:col-span-2 group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-flag text-green-500 mr-2"></i>UF <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-green-500 transition-colors">
                                <i class="fas fa-flag text-lg"></i>
                            </span>
                            <input type="text" name="state" id="id_state" value="{{ form.state.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300 text-gray-800 uppercase"
                                placeholder="UF" maxlength="2">
                        </div>
                        {% if form.state.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.state.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Card: Dados Bancários -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform hover:scale-[1.01] transition-transform duration-300">
            <div class="bg-gradient-to-r from-amber-500 via-orange-500 to-red-500 px-6 py-4">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="bg-white/20 rounded-lg p-2 mr-3">
                        <i class="fas fa-university text-xl"></i>
                    </span>
                    Dados Bancários
                </h3>
                <p class="text-orange-100 text-sm mt-1 ml-12">Informações para pagamento e repasse</p>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-building-columns text-orange-500 mr-2"></i>Banco <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-orange-500 transition-colors">
                                <i class="fas fa-university text-lg"></i>
                            </span>
                            {{ form.bank_name }}
                        </div>
                        {% if form.bank_name.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.bank_name.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-landmark text-orange-500 mr-2"></i>Agência <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-orange-500 transition-colors">
                                <i class="fas fa-list-ol text-lg"></i>
                            </span>
                            <input type="text" name="bank_agency" id="id_bank_agency" value="{{ form.bank_agency.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 text-gray-800"
                                placeholder="Agência">
                        </div>
                        {% if form.bank_agency.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.bank_agency.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-wallet text-orange-500 mr-2"></i>Conta <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-orange-500 transition-colors">
                                <i class="fas fa-credit-card text-lg"></i>
                            </span>
                            <input type="text" name="bank_account" id="id_bank_account" value="{{ form.bank_account.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 text-gray-800"
                                placeholder="Conta com dígito">
                        </div>
                        {% if form.bank_account.errors %}
                        <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.bank_account.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div class="group">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-key text-orange-500 mr-2"></i>Chave PIX <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400 group-focus-within:text-orange-500 transition-colors">
                                <i class="fas fa-key text-lg"></i>
                            </span>
                            <input type="text" name="bank_pix_key" id="id_bank_pix_key" value="{{ form.bank_pix_key.value|default:'' }}"
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 text-gray-800"
                                placeholder="CPF, e-mail, telefone ou chave aleatória">
                        </div>
                        <p class="mt-1 text-xs text-gray-500"><i class="fas fa-info-circle mr-1"></i>Preferencialmente a chave principal do prestador</p>
                        {% if form.bank_pix_key.errors %}
                        <p class="mt-1 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.bank_pix_key.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Card: Tipos de Serviço -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform hover:scale-[1.01] transition-transform duration-300">
            <div class="bg-gradient-to-r from-indigo-500 via-purple-500 to-fuchsia-500 px-6 py-4">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="bg-white/20 rounded-lg p-2 mr-3">
                        <i class="fas fa-tools text-xl"></i>
                    </span>
                    Tipos de Serviço
                </h3>
                <p class="text-purple-100 text-sm mt-1 ml-12">Selecione os serviços que o prestador executa</p>
            </div>

            <div class="p-6">
                <label class="block text-sm font-bold text-gray-700 mb-3">
                    {{ form.service_types.label }} <span class="text-red-500">*</span>
                </label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    {% for choice in form.service_types %}
                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                        {{ choice.tag }}
                        <span class="ml-2 text-gray-800">{{ choice.choice_label }}</span>
                    </label>
                    {% endfor %}
                </div>
                {% if form.service_types.errors %}
                <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.service_types.errors.0 }}</p>
                {% endif %}
                {% if form.service_types.help_text %}
                <p class="mt-2 text-sm text-gray-500">{{ form.service_types.help_text }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Card: Observações -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform hover:scale-[1.01] transition-transform duration-300">
            <div class="bg-gradient-to-r from-slate-500 via-gray-600 to-zinc-600 px-6 py-4">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="bg-white/20 rounded-lg p-2 mr-3">
                        <i class="fas fa-sticky-note text-xl"></i>
                    </span>
                    Observações
                </h3>
                <p class="text-gray-200 text-sm mt-1 ml-12">Notas internas sobre o prestador</p>
            </div>

            <div class="p-6">
                <label for="id_notes" class="block text-sm font-bold text-gray-700 mb-2">
                    {{ form.notes.label }}
                </label>
                <textarea name="notes" id="id_notes" rows="4"
                    class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-gray-500 focus:ring-4 focus:ring-gray-100 transition-all duration-300 text-gray-800"
                    placeholder="Observações internas sobre o prestador">{{ form.notes.value|default:'' }}</textarea>
                <p class="mt-1 text-sm text-gray-500">Essas observações não ficam visíveis para o prestador.</p>
                {% if form.notes.errors %}
                <p class="mt-2 text-sm text-red-600 flex items-center"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.notes.errors.0 }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Botões de Ação -->
        <div class="bg-white rounded-2xl shadow-xl p-6">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <p class="text-sm text-gray-500">
                    <i class="fas fa-asterisk text-red-500 mr-1"></i>
                    Campos marcados com <span class="text-red-500 font-bold">*</span> são obrigatórios
                </p>
                <div class="flex gap-4">
                    <a href="{% url 'provider:list' %}" class="group px-8 py-4 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-all duration-300 shadow-md hover:shadow-lg flex items-center">
                        <i class="fas fa-times mr-2 group-hover:rotate-90 transition-transform duration-300"></i>Cancelar
                    </a>
                    <button type="submit" class="group px-8 py-4 bg-gradient-to-r from-blue-500 via-purple-500 to-indigo-600 text-white rounded-xl font-bold hover:from-blue-600 hover:via-purple-600 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center">
                        <i class="fas fa-save mr-2 group-hover:scale-110 transition-transform duration-300"></i>{{ button_text }}
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cpfInput = document.getElementById('id_cpf');
    if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });
    }

    const phoneInput = document.getElementById('id_phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 10) {
                    value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{4})(\d)/, '$1-$2');
                } else {
                    value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                }
            }
            e.target.value = value;
        });
    }

    const cepInput = document.getElementById('id_zip_code');
    if (cepInput) {
        cepInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });
    }

    const stateInput = document.getElementById('id_state');
    if (stateInput) {
        stateInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });
    }

    const buscarCEPBtn = document.getElementById('buscarCEP');
    const cepStatus = document.getElementById('cepStatus');

    function showCEPStatus(message, type) {
        if (!cepStatus) return;
        cepStatus.className = 'p-3 rounded-xl text-sm flex items-center font-medium';

        if (type === 'loading') {
            cepStatus.className += ' bg-blue-100 text-blue-700 border border-blue-200';
            cepStatus.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i>${message}`;
        } else if (type === 'success') {
            cepStatus.className += ' bg-green-100 text-green-700 border border-green-200';
            cepStatus.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
        } else if (type === 'error') {
            cepStatus.className += ' bg-red-100 text-red-700 border border-red-200';
            cepStatus.innerHTML = `<i class="fas fa-times-circle mr-2"></i>${message}`;
        }

        cepStatus.classList.remove('hidden');
    }

    if (buscarCEPBtn && cepInput) {
        buscarCEPBtn.addEventListener('click', async function() {
            const cepValue = cepInput.value.replace(/\D/g, '');

            if (cepValue.length !== 8) {
                showCEPStatus('CEP deve ter 8 dígitos', 'error');
                return;
            }

            buscarCEPBtn.disabled = true;
            buscarCEPBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Buscando...';
            showCEPStatus('Consultando CEP...', 'loading');

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cepValue}/json/`);
                const data = await response.json();

                if (data.erro) {
                    throw new Error('CEP não encontrado');
                }

                const fields = [
                    { id: 'id_street', value: data.logradouro },
                    { id: 'id_neighborhood', value: data.bairro },
                    { id: 'id_city', value: data.localidade },
                    { id: 'id_state', value: data.uf }
                ];

                fields.forEach((field, index) => {
                    setTimeout(() => {
                        const input = document.getElementById(field.id);
                        if (input && field.value) {
                            input.value = field.value;
                            input.classList.add('bg-green-50');
                            setTimeout(() => input.classList.remove('bg-green-50'), 1000);
                        }
                    }, index * 100);
                });

                showCEPStatus('Endereço encontrado!', 'success');

                setTimeout(() => {
                    const numberInput = document.getElementById('id_number');
                    if (numberInput) {
                        numberInput.focus();
                    }
                }, 500);
            } catch (error) {
                showCEPStatus('CEP não encontrado', 'error');
            } finally {
                buscarCEPBtn.disabled = false;
                buscarCEPBtn.innerHTML = '<i class="fas fa-search mr-2"></i>Buscar CEP';
            }
        });

        cepInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscarCEPBtn.click();
            }
        });

        cepInput.addEventListener('input', function(e) {
            const value = e.target.value.replace(/\D/g, '');
            if (value.length === 8) {
                setTimeout(() => buscarCEPBtn.click(), 300);
            }
        });
    }
});
</script>
{% endblock %}

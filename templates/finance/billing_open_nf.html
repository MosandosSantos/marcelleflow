{% extends 'base/base.html' %}
{% block title %}Faturamento - NF abertas{% endblock %}
{% block page_title %}Faturamento{% endblock %}

{% block content %}
{% include 'finance/partials/billing_header.html' %}
{% include 'finance/partials/billing_tabs.html' %}

<div class="bg-white rounded-xl shadow-md overflow-hidden">
  <div class="px-6 py-4 border-b">
    <h3 class="text-lg font-semibold text-gray-800">NF abertas</h3>
    <p class="text-sm text-gray-500">NFs emitidas e ainda nao pagas.</p>
  </div>
  {% if installments %}
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-gray-50">
        <tr>
          <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">NF</th>
          <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">OS</th>
          <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Cliente</th>
          <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Parcela</th>
          <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Emissao</th>
          <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Vencimento</th>
          <th class="text-right py-4 px-6 text-sm font-semibold text-gray-700">Valor</th>
          <th class="text-center py-4 px-6 text-sm font-semibold text-gray-700">Acoes</th>
        </tr>
      </thead>
      <tbody>
        {% for nf in installments %}
        <tr class="border-t hover:bg-gray-50 transition-colors">
          <td class="py-4 px-6 text-sm text-gray-700">{{ nf.invoice_number|default:"-" }}</td>
          <td class="py-4 px-6 text-sm text-gray-700">{{ nf.work_order.code }}</td>
          <td class="py-4 px-6 text-sm text-gray-700">{{ nf.work_order.client.full_name|default:"-" }}</td>
          <td class="py-4 px-6 text-sm text-gray-700">{{ nf.installment_number }}/{{ nf.installment_total }}</td>
          <td class="py-4 px-6 text-sm text-gray-700">{{ nf.invoice_issued_at|date:"d/m/Y" }}</td>
          <td class="py-4 px-6 text-sm text-gray-700">{{ nf.data_vencimento|date:"d/m/Y" }}</td>
          <td class="py-4 px-6 text-sm text-gray-700 text-right">R$ {{ nf.valor|floatformat:2 }}</td>
          <td class="py-4 px-6 text-center">
            <a href="{% url 'finance:installment_nf' nf.id %}" class="text-indigo-600 hover:text-indigo-800" title="Ver NF/Boleto">
              <i class="fas fa-file-invoice"></i>
            </a>
            <a href="{% url 'finance:transaction_mark_completed' nf.id %}?next={% url 'finance:billing_closed_nf' %}" class="ml-3 text-emerald-600 hover:text-emerald-800" title="Registrar pagamento">
              <i class="fas fa-check-circle"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="text-center py-10 text-gray-500">
    <i class="fas fa-file-invoice text-4xl mb-3"></i>
    <p class="text-sm">Nenhuma NF aberta.</p>
  </div>
  {% endif %}
</div>
{% endblock %}

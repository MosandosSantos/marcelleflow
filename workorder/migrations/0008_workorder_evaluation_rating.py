# Generated by Django 5.2.8 on 2026-01-17 21:18

import django.core.validators
from django.db import migrations, models
import random


class Migration(migrations.Migration):

    dependencies = [
        ('workorder', '0007_alter_workorder_status'),
    ]

    def seed_ratings(apps, schema_editor):
        WorkOrder = apps.get_model('workorder', 'WorkOrder')
        qs = WorkOrder.objects.filter(status__status_code__in=['COMPLETED', 'FINANCIAL_CLOSED'])
        weights = [(5, 0.4), (4, 0.3), (3, 0.15), (2, 0.1), (1, 0.05)]
        values, probs = zip(*weights)
        for order in qs.iterator():
            if order.evaluation_rating and order.evaluation_rating > 0:
                continue
            order.evaluation_rating = random.choices(values, probs, k=1)[0]
            order.save(update_fields=['evaluation_rating'])

    operations = [
        migrations.AddField(
            model_name='workorder',
            name='evaluation_rating',
            field=models.PositiveSmallIntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(5)], verbose_name='Avalia??o (0-5 estrelas)'),
        ),
        migrations.RunPython(seed_ratings, migrations.RunPython.noop),
    ]
